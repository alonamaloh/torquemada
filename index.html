<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Prevent caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Torquemada Checkers</title>
    <link rel="stylesheet" href="style.css?v=20260208a">
    <!-- Enable SharedArrayBuffer for stop functionality -->
    <script src="coi-serviceworker.js"></script>
</head>
<body>
    <!-- Loading screen -->
    <div id="loading" class="loading-container">
        <div class="loading-content">
            <h1>Torquemada Checkers</h1>
            <div class="spinner"></div>
            <p id="loading-status">Loading...</p>
        </div>
    </div>

    <!-- Main game container -->
    <div id="game-container" class="game-container" style="display: none;">
        <!-- Header -->
        <header class="header">
            <h1>Torquemada Checkers</h1>
            <span id="thinking-indicator" class="thinking" style="display: none;">Thinking...</span>
        </header>

        <!-- Main content -->
        <main class="main-content">
            <!-- Board section -->
            <section class="board-section">
                <div id="board-container" class="board-container">
                    <canvas id="board" width="480" height="480"></canvas>
                </div>
                <p id="status" class="status-text">White to move</p>

                <!-- Search info display -->
                <div id="search-info" class="search-info" style="display: none;">
                    <div class="search-info-row">
                        <span class="search-label">Depth:</span>
                        <span id="search-depth">-</span>
                        <span class="search-label">Score:</span>
                        <span id="search-score">-</span>
                        <span class="search-label">Nodes:</span>
                        <span id="search-nodes">-</span>
                        <span class="search-label">NPS:</span>
                        <span id="search-nps">-</span>
                    </div>
                    <div class="search-info-row">
                        <span id="search-pv" class="search-pv">-</span>
                    </div>
                </div>
            </section>

            <!-- Controls section -->
            <section class="controls-section">
                <!-- Game controls -->
                <div id="game-controls" class="control-group">
                    <h3>Game</h3>
                    <button id="btn-new-game" class="btn">New Game</button>
                    <button id="btn-undo" class="btn" title="Undo" disabled>&#x2190;</button>
                    <button id="btn-redo" class="btn" title="Redo" disabled>&#x2192;</button>
                    <button id="btn-flip" class="btn">Flip Board</button>
                    <button id="btn-edit" class="btn">Edit</button>
                </div>

                <!-- Edit mode controls (hidden by default) -->
                <div id="edit-controls" class="control-group" style="display: none;">
                    <h3>Edit Position</h3>
                    <div class="piece-selector">
                        <button class="piece-btn active" data-piece="empty" title="Empty">
                            <span class="piece-icon empty"></span>
                        </button>
                        <button class="piece-btn" data-piece="white-man" title="White Man">
                            <span class="piece-icon white-man"></span>
                        </button>
                        <button class="piece-btn" data-piece="white-king" title="White King">
                            <span class="piece-icon white-king"></span>
                        </button>
                        <button class="piece-btn" data-piece="black-man" title="Black Man">
                            <span class="piece-icon black-man"></span>
                        </button>
                        <button class="piece-btn" data-piece="black-king" title="Black King">
                            <span class="piece-icon black-king"></span>
                        </button>
                    </div>
                    <div class="edit-actions">
                        <button id="btn-clear-board" class="btn btn-small">Clear</button>
                    </div>
                    <div class="side-to-move">
                        <label>Side to move:</label>
                        <div class="toggle-group">
                            <button id="btn-white-to-move" class="toggle-btn active">White</button>
                            <button id="btn-black-to-move" class="toggle-btn">Black</button>
                        </div>
                    </div>
                    <button id="btn-edit-done" class="btn btn-primary">Done</button>
                </div>

                <!-- Engine controls -->
                <div class="control-group">
                    <h3>Engine</h3>
                    <div class="input-group">
                        <span id="engine-time-left" class="time-left">00:00.0</span>
                        <span id="btn-time-per-move" class="time-per-move" title="Click to change">+3s/move</span>
                        <button id="btn-stop" class="btn btn-small" disabled>Stop</button>
                    </div>
                    <div class="toggle-group">
                        <button id="btn-engine-white" class="toggle-btn">Engine White</button>
                        <button id="btn-engine-black" class="toggle-btn active">Engine Black</button>
                        <button id="btn-two-player" class="toggle-btn">2 Player</button>
                    </div>
                </div>

                <!-- Move history -->
                <div class="control-group">
                    <h3>Move History</h3>
                    <div id="move-history" class="move-history"></div>
                </div>

                <!-- Tablebases -->
                <div class="control-group">
                    <h3>Tablebases</h3>
                    <button id="btn-download-tb" class="btn">Download Tablebases</button>
                    <p class="help-text">5-piece DTM tables (~140 MB)</p>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Torquemada Checkers Engine - WebAssembly Edition</p>
        </footer>
    </div>

    <!-- Download dialog -->
    <div id="download-dialog" class="dialog" style="display: none;">
        <div class="dialog-content">
            <h2>Downloading Tablebases</h2>
            <div class="progress-bar">
                <div class="progress" style="width: 0%"></div>
            </div>
            <p class="status">Preparing...</p>
            <button class="btn cancel-btn">Cancel</button>
        </div>
    </div>

    <!-- New game dialog -->
    <div id="new-game-dialog" class="dialog" style="display: none;">
        <div class="dialog-content dialog-narrow">
            <h2>New Game</h2>
            <p class="dialog-label">Play as:</p>
            <div class="dialog-buttons">
                <button id="btn-play-white" class="btn">White</button>
                <button id="btn-play-black" class="btn">Black</button>
                <button id="btn-play-both" class="btn">Both</button>
            </div>
        </div>
    </div>

    <!-- Time per move dialog -->
    <div id="time-dialog" class="dialog" style="display: none;">
        <div class="dialog-content dialog-narrow">
            <h2>Time per Move</h2>
            <div class="time-dialog-input">
                <input id="time-input" type="number" min="0.1" step="0.1" value="3">
                <span>seconds</span>
            </div>
            <div class="time-dialog-buttons">
                <button id="btn-time-ok" class="btn btn-primary">OK</button>
                <button id="btn-time-cancel" class="btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="main.js?v=20260208b"></script>
</body>
</html>
